{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "packageRules": [
    // Allowed Versions
    {
      "description": "PostgreSQL 16",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": ["postgresql"],
      "allowedVersions": "<17"
    },
    // Commit Messages
    {
      "matchPackageNames": [
        "*"
      ],
      "semanticCommitType": "chore"
    },
    {
      "matchDepTypes": [
        "dependencies",
        "require"
      ],
      "semanticCommitType": "fix"
    },
    {
      "matchDatasources": [
        "maven"
      ],
      "matchDepTypes": [
        "compile",
        "provided",
        "runtime",
        "system",
        "import",
        "parent"
      ],
      "semanticCommitType": "fix"
    },
    {
      "matchUpdateTypes": ["major"],
      "semanticCommitType": "⏫",
      "commitMessagePrefix": "{{semanticCommitType}}({{semanticCommitScope}})!:",
      "commitMessageExtra": "( {{currentVersion}} → {{newVersion}} )",
      "commitMessageAction": ""
    },
    {
      "matchUpdateTypes": ["minor"],
      "semanticCommitType": "⏫",
      "commitMessageExtra": "( {{currentVersion}} → {{newVersion}} )",
      "commitMessageAction": ""
    },
    {
      "matchUpdateTypes": ["patch"],
      "semanticCommitType": "⬆",
      "commitMessageExtra": "( {{currentVersion}} → {{newVersion}} )",
      "commitMessageAction": ""
    },
    {
      "matchUpdateTypes": ["digest"],
      "semanticCommitType": "🔄",
      "commitMessageExtra": "( {{currentDigestShort}} → {{newDigestShort}} )",
      "commitMessageAction": ""
    },
    {
      "matchDatasources": ["docker"],
      "semanticCommitScope": "cont",
      "commitMessageTopic": "image {{depName}}"
    },
    {
      "matchManagers": ["github-actions"],
      "semanticCommitScope": "ci"
    },
    {
      "addLabels": ["renovate/dash"],
      "matchDatasources": ["custom.grafana-dashboards"],
      "matchUpdateTypes": ["major"],
      "semanticCommitType": "🔄",
      "semanticCommitScope": "dash",
      "commitMessageTopic": "dashboard {{depName}}",
      "commitMessageExtra": "( {{currentVersion}} → {{newVersion}} )"
    },
    {
      "matchDatasources": ["helm"],
      "semanticCommitScope": "helm",
      "commitMessageTopic": "chart {{depName}}"
    },
    {
      "matchDatasources": ["pip_requirements", "pypi"],
      "semanticCommitScope": "pip"
    },
    // Labels
    {
      "matchDatasources": ["docker"],
      "addLabels": ["renovate/container"]
    },
    {
      "matchDatasources": ["helm"],
      "addLabels": ["renovate/helm"]
    },
    {
      "matchDatasources": ["github-releases", "github-tags"],
      "addLabels": ["renovate/gh-r"]
    },
    {
      "matchManagers": ["github-actions"],
      "addLabels": ["renovate/ci"]
    },
    {
      "matchDatasources": ["pypi"],
      "addLabels": ["renovate/pip"]
    },
    {
      matchDatasources: ["custom.grafana-dashboards"],
      addLabels: ["renovate/dash"]
    },
    {
      "matchUpdateTypes": ["major"],
      "labels": ["type/major"]
    },
    {
      "matchUpdateTypes": ["minor"],
      "labels": ["type/minor"]
    },
    {
      "matchUpdateTypes": ["patch"],
      "labels": ["type/patch"]
    },
    {
      "matchUpdateTypes": ["digest"],
      "labels": ["type/digest"]
    },
    // Versions
    {
      "enabled": true,
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "major"
      ]
    },
    {
      "description": ["Custom versioning for http-https-echo"],
      "matchDatasources": ["docker"],
      "versioning": "regex:^(?<major>\\d+)$",
      "matchPackagePatterns": ["mendhak/http-https-echo"],
    },
    {
      "description": ["Loose versioning for plex"],
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["plex"]
    },
    // Groups
    {
      "description": ["Actions Runner Controller Group"],
      "groupName": "Actions Runner Controller",
      "matchPackagePatterns": ["gha-runner-scale-set"],
      "matchDatasources": ["docker", "helm"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": "Cilium image and chart",
      "groupName": "cilium",
      "matchDepNames": [
        "quay.io/cilium/cilium",
        "quay.io/cilium/operator-generic",
        "cilium",
      ],
      "matchDatasources": ["helm", "docker"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group",
      },
      "separateMinorPatch": true,
    },
    {
      "description": ["Dragonfly Operator Group"],
      "groupName": "Dragonfly Operator",
      "matchPackagePatterns": ["dragonfly(?:db)?.operator"],
      "matchDatasources": ["docker", "github-releases"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": ["Flux Group"],
      "groupName": "Flux",
      "matchPackagePatterns": ["fluxcd"],
      "matchDatasources": ["docker", "github-tags"],
      "versioning": "semver",
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": ["Intel Device Plugins Group"],
      "groupName": "Intel-Device-Plugins",
      "matchPackagePatterns": ["intel-device-plugins"],
      "matchDatasources": ["helm"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": ["Rook-Ceph Group"],
      "groupName": "Rook-Ceph",
      "matchPackagePatterns": ["rook.ceph"],
      "matchDatasources": ["docker", "helm"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": ["System Upgrade Controller Group"],
      "groupName": "System Upgrade Controller",
      "matchPackagePatterns": ["system-upgrade-controller"],
      "matchDatasources": ["docker", "github-releases"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": ["Talos Group"],
      "groupName": "Talos",
      "matchPackagePatterns": [
        "siderolabs/talosctl",
        "siderolabs/installer"
      ],
      "matchDatasources": ["docker"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": "Thanos Group - mismatched versions",
      "groupName": "Thanos",
      "matchPackagePatterns": ["thanos"],
      "matchDatasources": ["docker", "github-releases", "helm"],
      "matchUpdateTypes": ["minor", "patch"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group",
      },
      "separateMinorPatch": false,
    },
    {
      "description": "Vector Group - mismatched versions",
      "groupName": "Vector",
      "matchPackagePatterns": ["vector"],
      "matchDatasources": ["docker", "github-releases", "helm"],
      "matchUpdateTypes": ["minor", "patch"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group",
      },
      "separateMinorPatch": false,
    },
    // Auto merge
    {
      "automerge": true,
      "extends": [
        "packages:linters"
      ]
    },
    {
      "description": ["Auto-merge container patches and digests updates for trusted containers"],
      "matchDatasources": ["docker"],
      "automerge": true,
      "automergeType": "pr",
      "assigneesFromCodeOwners": false,
      "matchUpdateTypes": ["patch", "digest"],
      "matchPackagePatterns": ["ghcr.io/bjw-s", "ghcr.io/onedr0p", "ghcr.io/tautulli/tautulli"],
    },
    {
      "description": ["Auto-merge container minor updates for trusted containers"],
      "matchDatasources": ["docker"],
      "automerge": true,
      "automergeType": "pr",
      "assigneesFromCodeOwners": false,
      "matchUpdateTypes": ["patch", "digest", "minor"],
      "matchPackagePatterns": ["ghcr.io/shamubernetes"],
    },
    {
      "description": ["Auto-merge GitHub Actions"],
      "matchManagers": ["github-actions"],
      "automerge": true,
      "automergeType": "pr",
      "assigneesFromCodeOwners": false,
      "matchUpdateTypes": ["minor", "patch", "digest", "pin"],
      "ignoreTests": true,
    },
    {
      "matchDatasources": ["custom.grafana-dashboards"],
      "automerge": true,
      "automergeType": "pr",
      "assigneesFromCodeOwners": false,
      "matchUpdateTypes": ["major"],
      "ignoreTests": true
    },
    {
      "description": "Auto merge KPS minors and patches",
      "matchDatasources": ["helm", "docker"],
      "automerge": true,
      "automergeType": "pr",
      "assigneesFromCodeOwners": false,
      "matchUpdateTypes": ["minor", "patch", "digest"],
      "matchPackagePatterns": ["kube-prometheus-stack"],
      "ignoreTests": false,
    },
    {
      "description": "Auto merge reloader minors and patches",
      "matchDatasources": ["helm", "docker"],
      "automerge": true,
      "matchUpdateTypes": ["patch"],
      "assigneesFromCodeOwners": false,
      "reviewers": [],
      "automergeType": "pr",
      "matchDepNames": ["reloader"],
      "ignoreTests": false,
    },
  ],
}